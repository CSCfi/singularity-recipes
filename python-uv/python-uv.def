Bootstrap: docker
From: rockylinux/rockylinux:8.10

%arguments
    PYTHON_VERSION=3.12

%post
    export PYTHON_VERSION={{PYTHON_VERSION}}

    # Install uv, a python package manager
    export UV_INSTALL_DIR=/usr/local/bin
    curl -LsSf https://astral.sh/uv/install.sh | sh

    # Set environment variables for uv
    export UV_LINK_MODE=copy
    export UV_CACHE_DIR=/opt/uv
    export UV_PYTHON_CACHE_DIR=/opt/uv
    export UV_PYTHON_BIN_DIR=/opt/uv
    export UV_PYTHON_INSTALL_DIR=/opt/uv
    export UV_TOOL_BIN_DIR=/opt/uv
    export UV_TOOL_DIR=/opt/uv

    # Install python
    uv python install "$PYTHON_VERSION"

    # Create and activate a virtual environment
    uv venv --python "$PYTHON_VERSION" /opt/myenv
    . /opt/myenv/bin/activate

    # Install python packages
    # uv pip install ...

%environment
    export PYTHON_VERSION={{PYTHON_VERSION}}
    export UV_LINK_MODE=copy
    export UV_CACHE_DIR=/opt/uv
    export UV_PYTHON_CACHE_DIR=/opt/uv
    export UV_PYTHON_BIN_DIR=/opt/uv
    export UV_PYTHON_INSTALL_DIR=/opt/uv
    export UV_TOOL_BIN_DIR=/opt/uv
    export UV_TOOL_DIR=/opt/uv

%runscript
    . /opt/myenv/bin/activate
    eval "$@"
